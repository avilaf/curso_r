---
title: "SoundShape R Notebook"
output: html_soundShape_notebook
editor_options: 
  markdown: 
    wrap: 80
---

# Tutorial: An√°lisis de Vocalizaciones con SoundShape en R

## Introducci√≥n

Este tutorial te ense√±ar√° a analizar vocalizaciones de anfibios usando R y el
paquete SoundShape. Aprender√°s a convertir sonidos en datos morfom√©tricos que
pueden ser analizados estad√≠sticamente.

### ¬øQu√© es SoundShape?

SoundShape es un paquete de R que permite analizar sonidos como si fueran formas
tridimensionales, aplicando t√©cnicas de morfometr√≠a geom√©trica tradicionalmente
usadas en biolog√≠a para estudiar formas de organismos.

### Objetivos del tutorial:

-   Importar y visualizar archivos de audio
-   Alinear sonidos para comparaci√≥n
-   Realizar an√°lisis de componentes principales (PCA)
-   Crear superficies hipot√©ticas de sonido

--------------------------------------------------------------------------------

## Parte 1: Preparaci√≥n del Entorno

### 1.1 ¬øQu√© es un paquete en R?

Un paquete es una colecci√≥n de funciones que extienden las capacidades b√°sicas
de R. Es como una "caja de herramientas" especializada.

### 1.2 Instalaci√≥n y carga de paquetes

``` r
# IMPORTANTE: Solo necesitas instalar un paquete UNA VEZ
# Descomenta la siguiente l√≠nea si es tu primera vez usando SoundShape:
# install.packages("SoundShape")

# Cargar el paquete (esto lo haces cada vez que abres R)
library(SoundShape)
```

**üí° Consejo para principiantes:** - `install.packages()` = descargar e instalar
(solo una vez) - `library()` = cargar para usar (cada sesi√≥n de R)

### 1.3 Configuraci√≥n del directorio de trabajo

``` r
# ¬øQu√© es un directorio de trabajo?
# Es la carpeta donde R buscar√° tus archivos por defecto

# MODIFICA esta ruta seg√∫n donde tengas tus archivos de audio:
path <- "D:/curso_r-main/datos/vocalizaciones"
setwd(path)

# Verificar qu√© archivos tienes en la carpeta
dir()
```

**üîß Ejercicio 1:** Cambia la ruta `path` por la carpeta donde tienes tus
archivos de audio. Si no tienes archivos, crea una carpeta llamada
"vocalizaciones" en tu escritorio.

### 1.4 Crear carpeta para resultados

``` r
# Crear una subcarpeta para guardar los resultados
store_at <- file.path(getwd(), "output")
dir.create(store_at)

# getwd() = obtener directorio actual
# file.path() = crear rutas de archivos de forma segura
# dir.create() = crear una nueva carpeta
```

--------------------------------------------------------------------------------

## Parte 2: Importaci√≥n y Visualizaci√≥n de Audio

### 2.1 ¬øQu√© es un archivo .wav?

Un archivo .wav es un formato de audio sin compresi√≥n que preserva toda la
informaci√≥n del sonido, ideal para an√°lisis cient√≠ficos.

### 2.2 Importar nuestro primer archivo de audio

``` r
# Importar el primer archivo de audio
boana_pardalis <- tuneR::readWave("boana_pardalis.wav")

# Ver informaci√≥n b√°sica del archivo
boana_pardalis
```

**¬øQu√© significa `tuneR::`?** - `tuneR` es otro paquete de R para an√°lisis de
audio - `::` significa "usar la funci√≥n de este paquete espec√≠fico" - Es como
decir "usa la funci√≥n readWave del paquete tuneR"

### 2.3 Crear un espectrograma

Un espectrograma es una representaci√≥n visual del sonido que muestra: - **Eje
X**: Tiempo - **Eje Y**: Frecuencia (Hz) - **Colores**: Intensidad del sonido

``` r
# Crear espectrograma
seewave::spectro(boana_pardalis,
                 flim = c(0, 1.8),    # l√≠mites de frecuencia (0-1.8 kHz)
                 wl = 512,            # ventana de an√°lisis
                 f = 44100,           # frecuencia de muestreo
                 ovlp = 70,           # solapamiento entre ventanas (70%)
                 grid = FALSE)        # sin cuadr√≠cula
```

**üìä Par√°metros explicados:** - `flim`: rango de frecuencias a mostrar - `wl`:
tama√±o de la ventana de an√°lisis (m√°s grande = mejor resoluci√≥n frecuencial) -
`ovlp`: solapamiento entre ventanas (m√°s alto = m√°s suave pero m√°s lento)

### 2.4 Analizar m√∫ltiples especies

Vamos a importar y visualizar vocalizaciones de diferentes especies:

``` r
# Boana pardalis (muestra 2)
boana_pardalis_2 <- tuneR::readWave("boana_pardalis_2.wav")
seewave::spectro(boana_pardalis_2,
                 flim = c(0, 1.8), wl = 512, f = 44100, ovlp = 70, grid = FALSE)

# Boana marginata
boana_marginata <- tuneR::readWave("boana_marginata.wav")
seewave::spectro(boana_marginata,
                 flim = c(0, 4),      # Nota: rango de frecuencia diferente
                 wl = 512, f = 44100, ovlp = 70, grid = FALSE)

# Boana faber
boana_faber <- tuneR::readWave("boana_faber.wav")
seewave::spectro(boana_faber,
                 flim = c(0, 1.8), wl = 512, f = 44100, ovlp = 70, grid = FALSE)

# Boana faber (muestra 2)
boana_faber_2 <- tuneR::readWave("boana_faber_2.wav")
seewave::spectro(boana_faber_2,
                 flim = c(0, 1.8), wl = 512, f = 44100, ovlp = 70, grid = FALSE)
```

**üîç Ejercicio 2:** Observa los espectrogramas y anota las diferencias que ves
entre especies: - ¬øCu√°l tiene frecuencias m√°s altas? - ¬øCu√°l dura m√°s tiempo? -
¬øVes patrones diferentes?

--------------------------------------------------------------------------------

## Parte 3: Alineaci√≥n de Sonidos

### 3.1 ¬øPor qu√© alinear sonidos?

Para comparar sonidos de diferentes grabaciones, necesitamos que todos comiencen
en el mismo punto temporal y tengan la misma duraci√≥n.

``` r
# Alinear todos los sonidos
SoundShape::align.wave(wav.at = path,           # carpeta con archivos originales
                       wav.to = "Aligned",      # subcarpeta para archivos alineados
                       time.length = 0.15,      # duraci√≥n est√°ndar (150 ms)
                       flim = c(0.1, 5))        # rango de frecuencias
```

**‚öôÔ∏è Par√°metros explicados:** - `time.length`: todos los sonidos tendr√°n esta
duraci√≥n - `flim`: solo analizar frecuencias en este rango

### 3.2 Verificar la alineaci√≥n

``` r
# Crear visualizaci√≥n 2D para verificar alineaci√≥n
SoundShape::eigensound(analysis.type = "twoDshape",
                       wav.at = file.path(path, "Aligned"),
                       store.at = store_at,
                       plot.exp = TRUE,
                       flim = c(0, 6),
                       tlim = c(0, 0.3))
```

Esta funci√≥n crea una representaci√≥n bidimensional que te permite ver si todos
los sonidos est√°n correctamente alineados.

--------------------------------------------------------------------------------

## Parte 4: An√°lisis de Eigenvectores (An√°lisis Principal)

### 4.1 ¬øQu√© son los eigenvectores en este contexto?

Los eigenvectores son direcciones principales de variaci√≥n en los datos. En
SoundShape, representan las formas principales en que los sonidos difieren entre
s√≠.

``` r
# Realizar an√°lisis 3D completo
eig_boana <- SoundShape::eigensound(analysis.type = "threeDshape",
                                    wav.at = file.path(path, "Aligned"),
                                    store.at = store_at,
                                    plot.exp = TRUE, 
                                    flim = c(0, 6), 
                                    tlim = c(0, 0.3))

# Ver el resultado
eig_boana
```

**üìà ¬øQu√© hace esta funci√≥n?** 1. Convierte cada sonido en una superficie 3D 2.
Identifica puntos de referencia (semilandmarks) 3. Calcula las principales
diferencias entre sonidos

--------------------------------------------------------------------------------

## Parte 5: An√°lisis de Componentes Principales (PCA)

### 5.1 ¬øQu√© es un PCA?

El PCA es una t√©cnica que simplifica datos complejos identificando las
dimensiones de mayor variaci√≥n. Es como encontrar los ejes principales que mejor
explican las diferencias entre tus datos.

``` r
# Realizar PCA
pca_eig_boana <- stats::prcomp(geomorph::two.d.array(eig_boana))

# Ver resumen de resultados
summary(pca_eig_boana)
```

**üìä Interpretando el resumen:** - **Standard deviation**: cu√°nta variaci√≥n
explica cada componente - **Proportion of Variance**: porcentaje de variaci√≥n
total que explica cada PC - **Cumulative Proportion**: porcentaje acumulado

### 5.2 Asignar grupos (especies)

``` r
# Ver los nombres de las muestras
dimnames(eig_boana)[[3]]

# Crear vector de grupos (especies)
sample_gr <- factor(c("faber",      # muestra 1
                      "faber",      # muestra 2  
                      "marginata",  # muestra 3
                      "pardalis",   # muestra 4
                      "pardalis"))  # muestra 5
```

**üí° ¬øQu√© es un factor?** Un factor es un tipo de variable en R que representa
categor√≠as (como especies, tratamientos, etc.).

### 5.3 Crear gr√°fico de PCA

``` r
# Configurar √°rea de gr√°fico
par(mfrow = c(1,1),    # 1 fila, 1 columna
    mar = c(4,4,1,1))  # m√°rgenes del gr√°fico

# Crear gr√°fico de PCA
SoundShape::pca.plot(pca_eig_boana,
                     groups = sample_gr,        # colorear por especie
                     conv.hulls = sample_gr,    # envolturas convexas por grupo
                     leg.pos = "bottom",        # posici√≥n de leyenda
                     cex = 1.2)                 # tama√±o de puntos
```

**üé® Ejercicio 3:** Interpreta el gr√°fico de PCA: - ¬øQu√© especies se separan
mejor? - ¬øCu√°nta variaci√≥n explican PC1 y PC2 juntos? - ¬øHay solapamiento entre
especies?

--------------------------------------------------------------------------------

## Parte 6: Superficies Hipot√©ticas de Sonido

### 6.1 ¬øQu√© son las superficies hipot√©ticas?

Son representaciones 3D que muestran c√≥mo se ver√≠a un sonido "promedio" o c√≥mo
cambiar√≠an los sonidos a lo largo de los componentes principales.

### 6.2 Superficie promedio (consenso)

``` r
# Crear superficie del sonido promedio
SoundShape::hypo.surf(eig_boana,
                      PC = "mean",      # usar promedio
                      flim = c(0, 4),   # l√≠mites de frecuencia
                      tlim = c(0, 0.8), # l√≠mites de tiempo
                      x.length = 70,    # resoluci√≥n eje X
                      y.length = 47,    # resoluci√≥n eje Y
                      cex.lab = 0.7,    # tama√±o etiquetas
                      cex.axis = 0.5,   # tama√±o n√∫meros ejes
                      cex.main = 1)     # tama√±o t√≠tulo
```

### 6.3 Variaci√≥n a lo largo del PC1

``` r
# Mostrar variaci√≥n en el Componente Principal 1
SoundShape::hypo.surf(eig_boana,
                      PC = 1,           # usar PC1
                      flim = c(0, 4), tlim = c(0, 0.8),
                      x.length = 70, y.length = 47,
                      cex.lab = 0.7, cex.axis = 0.5, cex.main = 1)
```

Esta funci√≥n crear√° dos gr√°ficos: - M√≠nimo PC1: sonido en el extremo negativo -
M√°ximo PC1: sonido en el extremo positivo

### 6.4 Variaci√≥n a lo largo del PC2

``` r
# Mostrar variaci√≥n en el Componente Principal 2
SoundShape::hypo.surf(eig_boana,
                      PC = 2,           # usar PC2
                      flim = c(0, 4), tlim = c(0, 0.8),
                      x.length = 70, y.length = 47,
                      cex.lab = 0.7, cex.axis = 0.5, cex.main = 1)
```

**üî¨ Ejercicio 4:** Compara las superficies hipot√©ticas: - ¬øEn qu√© se diferencia
PC1 del promedio? - ¬øQu√© caracter√≠sticas del sonido cambian m√°s en PC2?

--------------------------------------------------------------------------------

## Parte 7: Informaci√≥n del Sistema y Referencias

### 7.1 Citar el software utilizado

``` r
# Citar SoundShape
citation("SoundShape")

# Citar R
citation()

# Ver versi√≥n de RStudio
RStudio.Version()
```

**üìö ¬øPor qu√© es importante citar?** En ciencia, siempre debemos reconocer las
herramientas que usamos. Esto permite: - Reproducibilidad de los an√°lisis -
Reconocimiento a los desarrolladores - Verificaci√≥n de m√©todos por otros
investigadores

--------------------------------------------------------------------------------

## Ejercicios Adicionales para Practicar

### Ejercicio 5: An√°lisis completo

1.  Consigue 3-5 archivos de audio de diferentes especies
2.  Repite todo el an√°lisis
3.  Interpreta los resultados

### Ejercicio 6: Modificar par√°metros

1.  Cambia los valores de `flim` en los espectrogramas
2.  Prueba diferentes valores de `time.length` en la alineaci√≥n
3.  Observa c√≥mo cambian los resultados

### Ejercicio 7: Interpretaci√≥n biol√≥gica

1.  ¬øQu√© significan biol√≥gicamente las diferencias encontradas?
2.  ¬øPodr√≠an estas diferencias estar relacionadas con el tama√±o corporal?
3.  ¬øQu√© hip√≥tesis evolutivas podr√≠as plantear?

--------------------------------------------------------------------------------

## Glosario de T√©rminos

-   **Espectrograma**: Representaci√≥n visual de un sonido mostrando frecuencia
    vs tiempo
-   **PCA**: An√°lisis que encuentra las principales direcciones de variaci√≥n en
    los datos
-   **Eigenvector**: Vector que representa una direcci√≥n principal de variaci√≥n
-   **Semilandmark**: Punto de referencia en una forma que puede deslizarse a lo
    largo de contornos
-   **Factor**: Variable categ√≥rica en R (como especie, tratamiento, etc.)
-   **Frecuencia de muestreo**: Cu√°ntas veces por segundo se mide el sonido (Hz)

--------------------------------------------------------------------------------

## Consejos para el √âxito

1.  **Empieza simple**: Usa pocos archivos al principio
2.  **Verifica cada paso**: Revisa que cada gr√°fico tenga sentido
3.  **Guarda tu trabajo**: Usa `save()` para guardar objetos importantes
4.  **Documenta todo**: Escribe comentarios explicando qu√© hace cada l√≠nea
5.  **Practica**: La bioac√∫stica requiere experiencia interpretando patrones

--------------------------------------------------------------------------------

## Recursos Adicionales

-   **Manual de SoundShape**: <https://cran.r-project.org/package=SoundShape>
-   **Introducci√≥n a R**:
    <https://cran.r-project.org/doc/manuals/r-release/R-intro.html>
-   **Morfometr√≠a geom√©trica**: Zelditch et al. (2012) - Geometric Morphometrics
    for Biologists

¬°Felicitaciones! Has completado tu primer an√°lisis de morfometr√≠a ac√∫stica en R.
üéâ
